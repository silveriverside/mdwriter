# AI 功能配置说明

## 模型配置

### 基本设置
1. 点击工具栏的"设置"图标打开模型配置对话框
2. 在下拉列表中选择现有配置或创建新配置
   - 当前正在使用的配置会在下拉列表中标记为"当前使用"
3. 填写以下信息：
   - 配置名称：配置的唯一标识名称
   - API类型：选择OpenAI兼容或自定义API
   - Base URL：API 服务器地址（例如：https://api.openai.com/v1）
   - API Key：API 密钥
   - Model：模型名称（例如：gpt-3.5-turbo）
   - 自定义请求模板：使用自定义API时的请求模板

### 配置操作
- **切换配置**：选择配置后点击"切换到此配置"按钮，直接使用该配置而不修改内容
- **保存修改**：修改配置后点击"保存修改"按钮，保存当前修改
  - 如果使用原配置名称，将更新现有配置
  - 如果使用新配置名称，将创建新配置
- **删除配置**：点击"删除"按钮移除当前选择的配置（至少需保留一个配置）

### 配置示例
```json
{
  "baseUrl": "https://api.openai.com/v1",
  "apiKey": "your-api-key",
  "model": "gpt-3.5-turbo"
}
```

### 配置存储
- 配置信息使用 SharedPreferences 本地存储
- API 密钥会进行加密存储
- 支持多个配置文件切换
- 配置更改后即时生效

## 提示词模板配置

提示词模板位于 `config/prompt_templates.json` 文件中，支持多种场景的模板配置。

### 模板结构
```json
{
  "模板名称": {
    "system": "系统提示词",
    "user_with_original": "包含原文的用户提示词模板",
    "user_without_original": "不包含原文的用户提示词模板",
    "temperature": 生成温度（0-1之间的浮点数）,
    "max_tokens": 最大生成长度
  }
}
```

### 可用变量
- {instruction}：用户指令
- {original_content}：原文内容（如果有）

### 默认模板
1. default：通用文本优化
   - 适用于一般性的文本修改和优化
   - 平衡的生成温度（0.7）

2. academic：学术写作
   - 适用于学术论文的修改和优化
   - 较低的生成温度（0.3）确保输出的严谨性

3. creative：创意写作
   - 适用于文学创作和创意内容
   - 较高的生成温度（0.9）以增加创意性

### 自定义模板
你可以通过编辑 prompt_templates.json 文件添加新的模板：

```json
{
  "custom_template": {
    "system": "自定义系统提示词",
    "user_with_original": "自定义用户提示词（包含原文）",
    "user_without_original": "自定义用户提示词（不包含原文）",
    "temperature": 0.5,
    "max_tokens": 2000
  }
}
```

## 功能说明

### 1. AI 标签使用
- `<ai>指令</ai>`：生成新内容
- `<ai>指令<origintext>原文</origintext></ai>`：修改现有内容
- 使用Tab键快速创建：
  - 在行首按Tab：插入两个空格作为缩进
  - 在行中或行末按Tab：自动将整行文本用<ai></ai>标签包裹并立即执行AI处理
- 标签编辑功能：
  - 当光标位于AI标签内时，点击"添加AI标签"按钮将删除该标签（包括嵌套的原文标签）
  - 当光标位于原文标签内时，点击"添加原文标签"按钮将删除该标签（保留外层AI标签）
  - 当选中文本时，点击相应按钮将为选中文本添加对应标签

### 2. 工作流程
1. 准备阶段
   - 确保已正确配置模型参数
   - 在编辑器中插入 AI 标签（可使用Tab键快速创建）
   - 编写清晰的指令说明

2. 处理阶段
   - 点击"开始"按钮或使用Tab键触发处理
   - 实时显示生成内容
   - 可随时点击"停止"按钮中断
   - 支持批量处理多个 AI 块

3. 结果处理
   - 在右侧面板查看生成结果
   - 显示原始指令和原文
   - 可以编辑生成的内容：
     - 点击"编辑"按钮进入编辑模式
     - 直接修改生成的文本
     - 点击"保存"应用修改或"取消"放弃修改
   - 点击"替换"按钮将结果应用到原文
   - 支持选择性替换

### 3. 错误处理
1. 配置错误
   - 检查 API 地址格式
   - 验证 API 密钥有效性
   - 确认模型名称正确

2. 网络错误
   - 检查网络连接
   - 确认 API 服务可用
   - 支持自动重试

3. 处理错误
   - 显示详细错误信息
   - 提供错误解决建议
   - 支持手动重试

### 4. 性能优化
1. 流式响应
   - 实时显示生成内容
   - 减少等待时间
   - 支持长文本处理

2. 请求管理
   - 支持取消请求
   - 避免重复请求
   - 资源自动释放

3. 内容缓存
   - 缓存生成结果
   - 避免重复生成
   - 支持结果恢复

## 注意事项

1. API 使用
   - 确保 API 配置正确
   - 注意 API 的速率限制
   - 合理设置超时时间

2. 内容处理
   - 合理设置提示词模板
   - 避免过长的输入文本
   - 注意内容的安全性

3. 性能考虑
   - 避免同时处理过多 AI 块
   - 注意网络带宽使用
   - 合理使用停止功能

4. 数据安全
   - 不要在提示词中包含敏感信息
   - 注意 API 密钥的安全存储
   - 定期检查访问日志