# MDWriter 功能说明文档

## 项目概述

MDWriter 是一个支持 Markdown 编辑的桌面应用程序，具有标题层级管理和 AI 标签系统等特色功能。

## 主要功能

### 1. 基础编辑功能

- 文件操作
  - 新建文件（支持 .md 和 .txt 格式）
  - 打开文件
  - 保存文件
  - 最近文件记录

- 文本编辑
  - 多行文本输入
  - 自动换行
  - 等宽字体显示
  - 智能Tab键功能
    - 在行首按Tab：插入两个空格作为缩进
    - 在行中或行末按Tab：自动将整行文本用<ai></ai>标签包裹并立即执行AI处理

### 2. Markdown 标题管理

- 标题层级操作
  - 提升标题级别（减少#号）
  - 降低标题级别（增加#号）
  - 切换标题/正文模式
  - 批量调整子标题级别

- 大纲视图
  - 实时显示文档结构
  - 标题层级缩进显示
  - 点击跳转到对应位置
  - 当前编辑位置高亮

### 3. AI 标签系统

- AI 标签操作
  - 选中文本时：在选中文字两侧插入 <ai> 和 </ai>
  - 未选中文本时：在光标位置插入 <ai></ai>，光标自动移动到标签中间
  - 在行中按Tab键：自动将整行文本转换为AI块

- 原文标签操作
  - 选中文本时：插入 <ai><origintext>选中文本</origintext></ai>
  - 未选中文本时：插入 <origintext></origintext> 并提示

- 可视化效果
  - 标签显示为小号灰色字体
  - AI 内容显示为黄色高亮背景
  - 原文内容显示为粉红色高亮背景

### 4. AI 辅助功能

- 模型配置
  - 支持配置 API 接口地址
  - 支持配置 API 密钥
  - 支持选择不同的模型
  - 支持管理和切换多个配置
  - 配置信息本地持久化
  - 提供直观的当前使用配置标记

- AI 处理功能
  - 一键处理所有 AI 标签内容
  - 实时流式响应显示
  - 支持随时停止生成
  - 支持处理多个 AI 块

- 结果管理
  - 右侧面板显示所有 AI 生成结果
  - 显示原始指令和原文内容
  - 支持编辑生成结果
    - 点击"编辑"按钮进入编辑模式
    - 直接修改生成的内容
    - 可以保存修改或取消编辑
  - 支持一键替换到原位置
  - 显示处理状态和错误信息

## 使用说明

### 文件操作

1. 新建文件
   - 点击工具栏的"新建文件"按钮
   - 输入文件名（自动添加 .md 扩展名）

2. 打开文件
   - 点击工具栏的"打开文件"按钮
   - 选择要打开的文件

3. 保存文件
   - 点击工具栏的"保存"按钮
   - 文件自动保存到原位置

### 标题操作

1. 标题级别调整
   - 使用工具栏的上箭头按钮提升标题级别
   - 使用工具栏的下箭头按钮降低标题级别
   - 使用切换按钮在标题和正文之间转换

2. 批量调整
   - 点击批量调整按钮
   - 在弹出的对话框中选择提升或降低级别
   - 当前标题及其所有子标题都会被调整

### AI 标签使用

1. 插入 AI 标签
   - 选中文本后点击 AI 标签按钮：将在选中文本两侧插入标签
   - 直接点击 AI 标签按钮：在光标位置插入空标签
   - 在行中按Tab键：自动将整行转换为AI块

2. 插入原文标签
   - 选中文本后点击原文标签按钮：将在选中文本外包裹 AI 和原文标签
   - 直接点击原文标签按钮：在光标位置插入空标签

### AI 功能使用

1. 配置模型
   - 点击右上角的设置图标
   - 从下拉列表选择已保存的配置，或创建新配置
   - 填写配置信息:
     - 选择API类型（OpenAI兼容或自定义API）
     - 填写API接口地址、密钥和模型名称（对于OpenAI兼容的API）
     - 或输入自定义请求模板（对于自定义API）
   - 使用"切换到此配置"按钮直接应用所选配置
   - 或点击"保存修改"按钮保存更改

2. 使用 AI 功能
   - 在文本中添加 AI 标签和指令
   - 如需修改已有文本，使用原文标签包裹
   - 点击"开始"按钮开始处理
   - 处理过程中可以点击"停止"按钮中断
   - 在行中按Tab键可快速创建并处理AI块

3. 处理结果
   - 在右侧面板查看生成结果
   - 每个 AI 块显示原始指令和内容
   - 可以点击"编辑"按钮修改生成的内容
   - 编辑完成后点击"保存"或"取消"
   - 点击"替换"按钮将结果替换到原位置
   - 如有错误会显示错误提示

## 注意事项

1. 标题级别限制
   - 最高为一级标题（单个#）
   - 最低为六级标题（六个#）
   - 超出范围的调整会被忽略

2. 标签嵌套规则
   - 原文标签必须在 AI 标签内部
   - AI 标签可以独立存在
   - 标签必须成对出现

3. AI 功能注意事项
   - 使用前必须先配置模型参数
   - 每个 AI 标签对之间的文本会作为指令处理
   - 支持批量处理多个 AI 块
   - 生成过程中可以随时停止
   - 替换操作不可撤销，请谨慎操作
   - 编辑生成结果后需要点击保存才会生效